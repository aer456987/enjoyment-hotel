import W from"./Icon.wjsf6Hii.js";import{f as X,y as Z,l as M,k,O as ee,m as $,o as r,c as i,b as f,w as V,g as e,A as se,a as s,t as c,F as h,r as P,B as Y,i as te,G as I,x as le,D as ae,p as de,e as oe}from"./entry.5F93Vz7a.js";import{u as re}from"./useTmpl.tD3N_OHk.js";import{_ as ie}from"./_plugin-vue_export-helper.x3n3nnut.js";import"./index.0wqzsba0.js";const m=D=>(de("data-v-7c7ea3ce"),D=D(),oe(),D),ne={class:"user-wrapper"},ue=m(()=>s("h6",{class:"fs-md-5 card-title m-0 fw-bold"},"修改密碼",-1)),ce={class:"card-content list-unstyled"},me=m(()=>s("div",{class:"mb-2 text-gray-80"},"電子信箱",-1)),fe={class:"fw-bold"},pe={key:0,class:"d-flex align-items-center gap-3"},be=m(()=>s("div",{class:"mb-2 text-gray-80"},"電子信箱",-1)),_e={class:"fw-bold ellipse-list"},ye=m(()=>s("label",{class:"form-label",for:"oldPassword"},"密碼",-1)),we={class:"text-danger fs-8 fw-bold mt-2"},he=m(()=>s("label",{class:"form-label",for:"newPassword"},"新密碼",-1)),ve={class:"text-danger fs-8 fw-bold mt-2"},ge=m(()=>s("label",{class:"form-label",for:"confirm"},"確認新密碼",-1)),Ve={class:"text-danger fs-8 fw-bold mt-2"},xe={key:0,class:"btn btn-primary",type:"submit"},Pe=m(()=>s("h6",{class:"fs-md-5 card-title m-0 fw-bold"},"基本資料",-1)),Ye={class:"card-content list-unstyled"},Me=m(()=>s("div",{class:"mb-2 text-gray-80"},"姓名",-1)),ke={class:"fw-bold"},De=m(()=>s("div",{class:"mb-2 text-gray-80"},"手機號碼",-1)),Ae={class:"fw-bold"},Ue=m(()=>s("div",{class:"mb-2 text-gray-80"},"生日",-1)),$e={class:"fw-bold"},Ie=m(()=>s("div",{class:"mb-2 text-gray-80"},"地址",-1)),qe={class:"fw-bold"},Ce=m(()=>s("label",{class:"form-label",for:"name"},"姓名",-1)),ze={class:"text-danger fs-8 fw-bold mt-2"},Ne=m(()=>s("label",{class:"form-label",for:"phone"},"手機號碼",-1)),Se={class:"text-danger fs-8 fw-bold mt-2"},Re=m(()=>s("label",{class:"form-label",for:"birthday"},"生日",-1)),Fe={class:"d-flex flex-row gap-2"},Be=["value"],Te=["value"],Le=["value"],Ee={class:"text-danger fs-8 fw-bold mt-2"},je=m(()=>s("label",{class:"form-label",for:"address"},"地址",-1)),Ge={class:"select-wrapper mb-3"},Oe=["value"],He=["value"],Je={class:"text-danger fs-8 fw-bold mt-2"},Ke={key:0,class:"d-flex"},Qe={key:1,class:"btn btn-primary",type:"submit"},We=X({__name:"index",async setup(D){let b,x;const q=Z(),n=M(()=>q.me),v=k({userId:n.value.id,oldPassword:"",newPassword:"",confirm:""}),{$dayjs:A}=I(),E=()=>{const[a,t,w]=A(n.value.birthday).format("YYYY-M-D").split("-").map(Number);return{Y:a,M:t,D:w}},{cityTmpl:j}=re(),d=k({userId:n.value.id,name:n.value.name,phone:n.value.phone,birthday:E(),address:{city:n.value.address.county,district:{district:n.value.address.city,zip_code:n.value.address.zipcode},detail:n.value.address.detail}}),{$validator:g}=I(),C={password:a=>a?g.isLength(a,{min:8})?g.isAlpha(a)?"密碼不能只有英文":g.isNumeric(a)?"密碼不能只有數字":g.isAlphanumeric(a)?{}:"密碼需至少 8 碼以上，並英數混合":"密碼需至少 8 碼以上":"密碼 為必填",newPassword:a=>a?g.isLength(a,{min:8})?g.isAlpha(a)?"新密碼不能只有英文":g.isNumeric(a)?"新密碼不能只有數字":g.isAlphanumeric(a)?{}:"新密碼需至少 8 碼以上，並英數混合":"新密碼需至少 8 碼以上":"新密碼 為必填"},z=M(()=>{const{Y:a,M:t}=d.value.birthday;return A(`${a}-${t}`,"YYYY-M").daysInMonth()});ee(()=>{z.value<d.value.birthday.D&&(d.value.birthday.D=1)});const N=k([]),_=k({password:{tool:!1},info:{tool:!1},submit:0}),S=k([null,null]),R=a=>{_.value.submit=a,J()},{updateUserApi:G,getUserApi:O,getTwzipcodeApi:H}=le(),{$swal:F}=I(),y=M(()=>B.value||L.value||T.value),{pending:B,refresh:J}=([b,x]=$(()=>G({body:M(()=>{if(_.value.submit===0){const{userId:a,oldPassword:t,newPassword:w}=v.value;return{userId:a,oldPassword:t,newPassword:w}}else{const{birthday:a,address:t,...w}=d.value,{Y:p,M:U,D:o}=a;return{...w,address:{zipcode:t.district.zip_code,detail:t.detail},birthday:A(`${p}-${U}-${o}`,"YYYY-M-D").format("YYYY-MM-DD")}}}),immediate:!1,watch:!1,onResponse({response:a}){a.status===200&&(a._data.status&&_.value.submit===0&&F.fire({icon:"success",title:"密碼重設成功"}).then(()=>{v.value={userId:n.value.id,oldPassword:"",newPassword:"",confirm:""},_.value.password.tool=!1}),a._data.status&&_.value.submit===1&&F.fire({icon:"success",title:"基本資料修改成功"}).then(()=>{K(),_.value.info.tool=!1}))}})),b=await b,x(),b);B.value=!1;const{pending:T,refresh:K}=([b,x]=$(()=>O({immediate:!1,watch:!1,onResponse({response:a}){if(a.status===200){const t=a._data.result;t.address.county=d.value.address.city,t.address.city=d.value.address.district.district,q.me=t}}})),b=await b,x(),b);T.value=!1;const{pending:L,refresh:Q}=([b,x]=$(()=>H({query:M(()=>({city:d.value.address.city})),immediate:!1,onResponse({response:a}){if(a.status===200){const t=a._data.data.map(w=>({zip_code:w.zip_code,district:w.district}));N.value=t,d.value.address.district=t[0]}}})),b=await b,x(),b);return L.value=!1,Q(),(a,t)=>{const w=W,p=ae,U=se;return r(),i("main",ne,[f(U,{ref:o=>e(S)[0]=o,class:"card-wrapper lh-lg ls-1 bg-white",onSubmit:t[4]||(t[4]=o=>R(0))},{default:V(({errors:o})=>[ue,s("ul",ce,[s("li",null,[me,s("div",fe,c(e(n).email),1)]),e(_).password.tool?(r(),i(h,{key:1},[s("li",null,[ye,f(p,{id:"oldPassword",modelValue:e(v).oldPassword,"onUpdate:modelValue":t[1]||(t[1]=l=>e(v).oldPassword=l),modelModifiers:{trim:!0},class:Y([o.oldPassword&&"verify-error","form-control"]),name:"oldPassword",label:"密碼",type:"password",placeholder:"請輸入舊密碼",rules:C.password,disabled:e(y)},null,8,["modelValue","class","rules","disabled"]),s("div",we,c(o.oldPassword),1)]),s("li",null,[he,f(p,{id:"newPassword",modelValue:e(v).newPassword,"onUpdate:modelValue":t[2]||(t[2]=l=>e(v).newPassword=l),modelModifiers:{trim:!0},class:Y([o.newPassword&&"verify-error","form-control"]),name:"newPassword",label:"新密碼",type:"password",placeholder:"請輸入新密碼",rules:C.newPassword,disabled:e(y)},null,8,["modelValue","class","rules","disabled"]),s("div",ve,c(o.newPassword),1)]),s("li",null,[ge,f(p,{id:"confirm",modelValue:e(v).confirm,"onUpdate:modelValue":t[3]||(t[3]=l=>e(v).confirm=l),modelModifiers:{trim:!0},class:Y([o.confirm&&"verify-error","form-control"]),name:"confirm",label:"確認新密碼",type:"password",placeholder:"請再輸入一次密碼",rules:"required|confirmed:@newPassword",disabled:e(y)},null,8,["modelValue","class","disabled"]),s("div",Ve,c(o.confirm),1)])],64)):(r(),i("li",pe,[s("div",null,[be,s("div",_e,[(r(),i(h,null,P(10,(l,u)=>f(w,{key:u,class:"ellipse",name:"ion:ellipse"})),64))])]),s("button",{class:"btn btn-text ms-auto",type:"button",onClick:t[0]||(t[0]=l=>e(_).password.tool=!0)}," 重設 ")]))]),e(_).password.tool?(r(),i("button",xe,"儲存設定")):te("",!0)]),_:1},512),f(U,{ref:o=>e(S)[1]=o,class:"card-wrapper lh-lg ls-1 bg-white",onSubmit:t[14]||(t[14]=o=>R(1))},{default:V(({errors:o})=>[Pe,s("ul",Ye,[e(_).info.tool?(r(),i(h,{key:1},[s("li",null,[Ce,f(p,{id:"name",modelValue:e(d).name,"onUpdate:modelValue":t[5]||(t[5]=l=>e(d).name=l),modelModifiers:{trim:!0},class:Y([o.name&&"verify-error","form-control"]),name:"name",label:"姓名",type:"text",placeholder:"請輸入姓名",rules:"required|min:2",disabled:e(y)},null,8,["modelValue","class","disabled"]),s("div",ze,c(o.name),1)]),s("li",null,[Ne,f(p,{id:"phone",modelValue:e(d).phone,"onUpdate:modelValue":t[6]||(t[6]=l=>e(d).phone=l),modelModifiers:{trim:!0},class:Y([o.phone&&"verify-error","form-control"]),name:"phone",label:"手機號碼",type:"text",placeholder:"請輸入手機號碼",rules:"required",disabled:e(y)},null,8,["modelValue","class","disabled"]),s("div",Se,c(o.phone),1)]),s("li",null,[Re,s("div",Fe,[f(p,{modelValue:e(d).birthday.Y,"onUpdate:modelValue":t[7]||(t[7]=l=>e(d).birthday.Y=l),class:"select flex-grow-1",name:"birthdayY",as:"select",rules:"required",disabled:e(y)},{default:V(()=>[(r(!0),i(h,null,P(Array.from({length:100},(l,u)=>Number(e(d).birthday.Y)-u),(l,u)=>(r(),i("option",{key:u,value:l},c(l)+" 年 ",9,Be))),128))]),_:1},8,["modelValue","disabled"]),f(p,{modelValue:e(d).birthday.M,"onUpdate:modelValue":t[8]||(t[8]=l=>e(d).birthday.M=l),class:"select flex-grow-1",name:"birthdayM",as:"select",rules:"required",disabled:e(y)},{default:V(()=>[(r(!0),i(h,null,P(Array.from({length:12},(l,u)=>u+1),(l,u)=>(r(),i("option",{key:u,value:l},c(l)+" 月 ",9,Te))),128))]),_:1},8,["modelValue","disabled"]),f(p,{modelValue:e(d).birthday.D,"onUpdate:modelValue":t[9]||(t[9]=l=>e(d).birthday.D=l),class:"select flex-grow-1",name:"birthdayD",as:"select",rules:"required",disabled:e(y)},{default:V(()=>[(r(!0),i(h,null,P(Array.from({length:e(z)},(l,u)=>u+1),(l,u)=>(r(),i("option",{key:u,value:l},c(l)+" 日 ",9,Le))),128))]),_:1},8,["modelValue","disabled"])]),s("div",Ee,c(o.birthday),1)]),s("li",null,[je,s("div",Ge,[f(p,{modelValue:e(d).address.city,"onUpdate:modelValue":t[10]||(t[10]=l=>e(d).address.city=l),class:"select",name:"addressCity",as:"select",rules:"required",disabled:e(y)},{default:V(()=>[(r(!0),i(h,null,P(e(j),(l,u)=>(r(),i("option",{key:u,value:l},c(l),9,Oe))),128))]),_:1},8,["modelValue","disabled"]),f(p,{modelValue:e(d).address.district,"onUpdate:modelValue":t[11]||(t[11]=l=>e(d).address.district=l),class:"select",name:"addressDistrict",as:"select",rules:"required",disabled:e(y)},{default:V(()=>[(r(!0),i(h,null,P(e(N),(l,u)=>(r(),i("option",{key:u,value:l},c(l.district),9,He))),128))]),_:1},8,["modelValue","disabled"])]),f(p,{id:"address",modelValue:e(d).address.detail,"onUpdate:modelValue":t[12]||(t[12]=l=>e(d).address.detail=l),modelModifiers:{trim:!0},class:Y([o.address&&"verify-error","form-control"]),name:"address",label:"詳細地址",type:"text",placeholder:"請輸入詳細地址",rules:"required",disabled:e(y)},null,8,["modelValue","class","disabled"]),s("div",Je,c(o.address),1)])],64)):(r(),i(h,{key:0},[s("li",null,[Me,s("div",ke,c(e(n).name),1)]),s("li",null,[De,s("div",Ae,c(e(n).phone),1)]),s("li",null,[Ue,s("div",$e,c(e(A)(e(n).birthday).format("YYYY 年 MM 月 DD 日")),1)]),s("li",null,[Ie,s("div",qe,c(e(n).address.county+e(n).address.city+e(n).address.detail),1)])],64))]),e(_).info.tool?(r(),i("button",Qe,"儲存設定")):(r(),i("div",Ke,[s("button",{class:"btn btn-outline-primary",type:"button",onClick:t[13]||(t[13]=l=>e(_).info.tool=!0)}," 編輯 ")]))]),_:1},512)])}}}),ls=ie(We,[["__scopeId","data-v-7c7ea3ce"]]);export{ls as default};
